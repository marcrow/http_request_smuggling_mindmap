# Exploitation Techniques

Techniques to exploit desync vulnerabilities for malicious purposes (defense research only)

## Response Queue Poisoning (RQP)
- Core exploitation primitive
- Attacker's prefix poisons victim's request
- Victim's response goes to attacker
- Allows reading sensitive data

## RQP Attack Flow
- Step 1: Identify desync vulnerability
- Step 2: Craft prefix request
  - `GPOST /account HTTP/1.1`
  - `Content-Length: 100`
  - (body contains session cookie trap)
- Step 3: Wait for victim request
- Step 4: Victim's request gets prefixed
- Step 5: Attacker receives victim's response

## RQP Results
- Attacker sees victim's page >>> RQP successful
  - Can extract sensitive data
  - Next step >>> Session hijack || Data exfiltration
- Session data leaked >>> Can extract cookies and CSRF tokens
  - Credential theft possible
  - Account takeover risk
- PII exposure >>> User emails, addresses, payment info visible
  - Data breach impact
  - Privacy violations
- Multi-user impact >>> Connection reuse affects random victims
  - Widespread exploitation
  - High severity

## Web Cache Poisoning
- Poison cached responses with attacker content
- Affects all users requesting cached resource
- Persistent impact (cache TTL)

## Cache Poisoning Attack
- Step 1: Find cacheable endpoint (static resources)
- Step 2: Smuggle request to poisoning endpoint
  - `GET /js/app.js HTTP/1.1`
  - `Host: attacker.com`
- Step 3: Response gets cached with attacker's content
- Step 4: All users receive poisoned cache

## Cache Poisoning Results
- Cache stores attacker's response >>> Poisoning successful
  - Users get malicious content
  - Next step >>> XSS delivery || Malware distribution
- Users get malicious JS >>> Can lead to XSS and credential theft
  - Code execution in user context
  - Session hijacking
- Cache-Control headers ignored >>> Persistent exploitation
  - Long-lasting impact
  - Affects all users
- CDN amplification >>> Affects multiple edge servers
  - Global impact
  - Widespread distribution

## XSS Gadget Exploitation
- Find reflected XSS sink
- Smuggle request with XSS payload
- Poison victim's response with XSS

## XSS Gadget Attack
- Step 1: Identify reflection point
  - Error messages
  - Search parameters
  - Path parameters
- Step 2: Smuggle XSS payload
  - `GET /search?q=<script>alert(1)</script> HTTP/1.1`
- Step 3: Victim's request gets prefixed
- Step 4: XSS executes in victim's context

## XSS Results
- Alert fires for victim >>> XSS successful
  - Code execution achieved
  - Next step >>> Session hijack || Credential harvest
- Can steal cookies >>> document.cookie exfiltration
  - Session hijacking
  - Account takeover
- Keylogging possible >>> Event listener injection
  - Credential capture
  - Sensitive data theft
- DOM manipulation >>> Fake login forms
  - Phishing attacks
  - Credential harvesting

## Open Redirect Gadget
- Abuse redirects to send victim to attacker site
- Combine with desync for persistent redirect

## Redirect Attack
- Step 1: Find redirect endpoint
  - `/login?redirect=/dashboard`
  - `/logout?next=/home`
- Step 2: Smuggle malicious redirect
  - `GET /login?redirect=https://attacker.com HTTP/1.1`
- Step 3: Victim follows poisoned redirect

## Redirect Results
- Victim redirected to attacker >>> Gadget working
  - Can phish credentials
  - OAuth token theft
- Can phish credentials >>> Fake login page
  - Credential capture
  - Account compromise
- OAuth token theft >>> Authorization code interception
  - API access
  - Account takeover
- Cookie leakage via Referer >>> Sensitive data exposure
  - Session token theft
  - Authentication bypass

## Request Routing Manipulation
- Change back-end routing via smuggled headers
- Access internal endpoints
- Bypass access controls

## Routing Attack
- Step 1: Smuggle routing headers
  - `X-Forwarded-Host: internal.example.com`
  - `X-Original-URL: /admin`
  - `X-Rewrite-URL: /secret`
- Step 2: Back-end routes to restricted resource

## Routing Results
- Access to /admin >>> Authorization bypass successful
  - Internal API exposure
  - Next step >>> Privilege escalation || Data access
- Internal API exposure >>> Sensitive operations accessible
  - SSRF via routing
  - Backend access
- SSRF via routing >>> Backend makes internal requests
  - Internal network access
  - Cloud metadata exploitation

## Credential Harvesting
- Inject fake login forms via poisoned responses
- Steal credentials in real-time

## Credential Harvest Attack
- Step 1: Poison response with fake form
- Step 2: Form submits to attacker server
- Step 3: User enters credentials
- Step 4: Attacker captures credentials

## Harvest Results
- Credentials received >>> Attack successful
  - Can replay credentials
  - Account takeover
- Can replay credentials >>> Account takeover
  - Session tokens included
  - Immediate access
- Session tokens included >>> Immediate access
  - Multi-factor codes captured
  - Real-time bypass
- Multi-factor codes >>> Real-time bypass
  - Complete account compromise
  - Full access

## Request Smuggling Scanner Evasion
- Use smuggling to hide attack payloads from WAF/IDS
- Scanner sees benign request
- Back-end processes malicious request

## Evasion Technique
- Front-end (WAF) sees: `GET / HTTP/1.1`
- Back-end processes: `GET /admin HTTP/1.1`
- Scanner only inspects front-end request

## Evasion Results
- WAF logs benign request >>> Evasion successful
  - Malicious request executed
  - No alerts triggered
- Malicious request executed >>> Back-end vulnerable
  - No alerts triggered
  - Stealthy exploitation
- No alerts triggered >>> Stealthy exploitation
  - Can chain with other attacks
  - SQLi, RCE, etc.
- Can chain with other attacks >>> SQLi, RCE, etc.
  - Complete compromise
  - Maximum impact
